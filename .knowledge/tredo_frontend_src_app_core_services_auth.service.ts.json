{"is_source_file": true, "format": "TypeScript", "description": "This file implements an Angular service called AuthService that manages user authentication, including token storage, user session management, login/logout mechanisms, role checks, and SSR compatibility.", "external_files": ["./api.service", "../models/user.model", "../../shared/utils/env"], "external_methods": ["isPlatformBrowser", "getFrontendUrl"], "published": ["AuthService"], "classes": [{"name": "AuthService", "description": "Angular service responsible for user authentication, session management, and role-based access control."}], "methods": [{"name": "getToken", "description": "Retrieves the current JWT token from localStorage if running in a browser environment."}, {"name": "setToken", "description": "Stores or removes the JWT token in localStorage, SSR-safe."}, {"name": "getUser", "description": "Returns the current authenticated user object if available."}, {"name": "isAuthenticated", "description": "Checks whether the user is currently authenticated based on token presence."}, {"name": "hasRole", "description": "Checks if the current user has one of the specified roles."}, {"name": "login", "description": "Performs user login via backend API or mock, updating session state on success."}, {"name": "me", "description": "Fetches the current user session from backend API or mock, updating local state."}, {"name": "logout", "description": "Clears authentication tokens and user data, notifying backend if necessary."}, {"name": "redirectToLogin", "description": "Returns the URL to redirect to login page, considering frontend base URL."}, {"name": "onAuth", "description": "Handles post-authentication processes like storing token and user info."}], "calls": ["this.api.post", "this.api.get", "this.api.mock ?", "this.setToken", "this.getToken", "this.redirectToLogin", "getFrontendUrl"], "search-terms": ["AuthService", "Angular", "JWT token storage", "SSR-safe localStorage access", "OAuth login", "Role-based authorization", "Authentication session management"], "state": 2, "file_id": 65, "knowledge_revision": 174, "git_revision": "df34bcb7696621fe785c8bf87964b72963e86853", "ctags": [{"_type": "tag", "name": "AuthService", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^export class AuthService {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "LoginResponse", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^type LoginResponse = { token: string; user: User };$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "TOKEN_KEY", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^const TOKEN_KEY = 'tredo.jwt';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "api", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^  private readonly api = inject(BaseApiService);$/", "language": "TypeScript", "kind": "property", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "mock", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^      const mock: LoginResponse = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "mock", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^      const mock: User = { id: 'u1', email: 'mock@tredo.app', name: 'Mock User', role: 'subscrib/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "name", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^        user: { id: 'u1', email, name: 'Mock User', role: 'subscriber' },$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "storage", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^      const storage: any = (globalThis as any)?.localStorage;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/tredo-investment-platform-184537-184546/tredo_frontend/src/app/core/services/auth.service.ts", "pattern": "/^    const user = this.currentUser;$/", "language": "TypeScript", "kind": "constant"}], "hash": "aa685f8189966968c4ab3c73be39e7e1", "format-version": 4, "code-base-name": "tredo_frontend", "filename": "tredo_frontend/src/app/core/services/auth.service.ts", "fields": [{"name": "private readonly api = inject(BaseApiService);", "scope": "AuthService", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"174": "df34bcb7696621fe785c8bf87964b72963e86853"}]}